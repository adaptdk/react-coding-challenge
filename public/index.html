<html>
<head>
<script src="https://unpkg.com/react@16/umd/react.development.js"> </script><script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js">
</script>
<script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
</head>
<body>
	yo
    <div id="root"></div>
    <script type="text/babel">
    
    /* 
    ADD REACT CODE HERE 
    */

    class App extends React.Component {	
	    constructor(){
	        super();
	        this.state = {
	            subjects: ["Fiction", "Science"],
	            subject: false,
	            books: [],
	            book: false,
	            bookEditerTitle: false,
	            bookEditerAuthor: false,
	            bookEditerBirthYear: false,
	            bookEditerDeathYear: false
	        };
	        this.selectSubject = this.selectSubject.bind(this);
	        this.selectBook = this.selectBook.bind(this);
	        this.keypressBookEdit = this.keypressBookEdit.bind(this);
	        this.saveBookEdit = this.saveBookEdit.bind(this);
	    }
	    selectSubject(subject) {
		    fetch('books?subjects_like=' + subject)
			    .then((results) => results.json())
		    	.then((data) =>
			        this.setState({
			            subject: subject,
			            books: data,
			            book: false
			        })
	        	);
	    }
	    selectBook(bookId) {
		    fetch('books?id_like=' + bookId)
			    .then((results) => results.json())
		    	.then((book) =>
			        this.setState({
			        	book: book[0],
			        	bookEditerTitle: book[0].title,
			        	bookEditerAuthor: book[0].authors[0].name,
			        	bookEditerBirthYear: book[0].authors[0].birth_year,
			        	bookEditerDeathYear: book[0].authors[0].death_year
			        })
	        	);
	    }
	    keypressBookEdit(event) {
			this.setState({ [event.target.name] : event.target.value}); 	
		}
	    saveBookEdit(book) {
	    	/* SEND UPDATE TO API, NOT IN USE YET. See last tab for PUT vs. PATCH */

		    fetch('books?id_like=' + book.id)
			    .then((results) => results.json())
		    	.then((book) =>
			        this.setState({
			        	book: book
			        })
	        	);
	    }
	    render() {
	        return <Chooser selectSubject={this.selectSubject} subjects={this.state.subjects} subject={this.state.subject} selectBook={this.selectBook} books={this.state.books} book={this.state.book} saveBookEdit={this.saveBookEdit} bookEditerTitle={this.state.bookEditerTitle} bookEditerAuthor={this.state.bookEditerAuthor} bookEditerBirthYear={this.state.bookEditerBirthYear} bookEditerDeathYear={this.state.bookEditerDeathYear} keypressBookEdit={this.keypressBookEdit} />;
	    }
	}

    class Chooser extends React.Component {	
	    render() {
	        return (
	        	<div>
					<SubjectChooser subjects={this.props.subjects} selectSubject={this.props.selectSubject} subject={this.props.subject}/>
	        		{this.props.subject ? <BookChooser selectBook={this.props.selectBook} books={this.props.books} /> : null}
	        		{this.props.book ? <BookInfoEditer saveBookEdit={this.props.saveBookEdit} book={this.props.book} bookEditerTitle={this.props.bookEditerTitle} bookEditerAuthor={this.props.bookEditerAuthor} bookEditerBirthYear={this.props.bookEditerBirthYear} bookEditerDeathYear={this.props.bookEditerDeathYear} keypressBookEdit={this.props.keypressBookEdit} /> : null}
	        	</div>
	        );
	    }
	}

    class SubjectChooser extends React.Component {	
	    render() {
	    	let selectSubject = this.props.selectSubject;
	    	let buttonsArray = this.props.subjects.map(function(subject, index){
				return <Button label={subject} key={index} updateFn={selectSubject} updateFnArg={subject} />;
			});

	        return (
	        	<div>
					<h2>Subjects</h2>
					{buttonsArray}
	        	</div>
	        );
	    }
	}

    class BookChooser extends React.Component {	
	    render() {
	    	let selectBook = this.props.selectBook;
	    	let buttons2Array = this.props.books.map(function(book, index){
				return <div key={index}><Button label={book.title} updateFn={selectBook} updateFnArg={book.id} /></div>;
			});

	        return (
	        	<div> 
	        		<h2>Books</h2>
	        		{buttons2Array}
	        	</div>
	        )
	    }
	}

    class BookInfoEditer extends React.Component {
    					/*
						  constructor(props) {
						    super(props);
						    this.state = {value: this.props.book.title};
						    this.handleChange = this.handleChange.bind(this);
						    this.handleSubmit = this.handleSubmit.bind(this);
						  }

						  handleChange(event) {
						    this.setState({value: event.target.value});
						  }

						  handleSubmit(event) {
						    alert('A name was submitted: ' + this.state.value);
						    event.preventDefault();
						  }


						  <label>Name:</label><input type="text" value={this.state.value} onChange={this.handleChange} />
						*/
    	render() {
    		return (
    			<form onSubmit={this.handleSubmit}>
    				<h2>Book Info</h2>
    				<InputField name="bookEditerTitle" value={this.props.bookEditerTitle} onChange={this.props.keypressBookEdit} />
    				<InputField name="bookEditerAuthor" value={this.props.bookEditerAuthor} onChange={this.props.keypressBookEdit} />
    				<InputField name="bookEditerBirthYear" value={this.props.bookEditerBirthYear} onChange={this.props.keypressBookEdit} />
    				<InputField name="bookEditerDeathYear" value={this.props.bookEditerDeathYear} onChange={this.props.keypressBookEdit} />
    				
    				<Button label="Update Info" updateFn={this.props.saveBookEdit} updateFnArg={null} />
    				<input type="submit" value="Submit" />
 		   		</form>
 		   	)
    	}
    }

    class Button extends React.Component {	
	    render() {
	        return <span onClick={() => this.props.updateFn(this.props.updateFnArg)}>{this.props.label}</span>;
	    }
	}

    class InputField extends React.Component {	
    	/* using value is uneditable but re-renders fine */
    	/* getting warning for using value sans onChange handler but defaultValue doesn't update field upon switching books */
	    
	    render() {
	        return <input value={this.props.value} name={this.props.name} onChange={this.props.onChange} />
	    }
	}

   	ReactDOM.render(
   	    <App />,  
   	    document.getElementById("root")
   	);

    
    </script>
</body>
</html>