<html>
<head>
<script src="https://unpkg.com/react@16/umd/react.development.js"> </script><script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js">
</script>
<script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
</head>
<body>
	yo
    <div id="root"></div>
    <script type="text/babel">
    
    /* 
    ADD REACT CODE HERE 
    */

    class App extends React.Component {	
	    constructor(){
	        super();
	        this.state = {
	            subjects: ["Fiction", "Science"],
	            subject: false,
	            books: [],
	            book: false
	        };
	        this.selectSubject = this.selectSubject.bind(this);
	        this.selectBook = this.selectBook.bind(this);
	        this.updateBookInfo = this.updateBookInfo.bind(this);
	    }
	    selectSubject(subject) {
		    fetch('books?subjects_like=' + subject)
			    .then((results) => results.json())
		    	.then((data) =>
			        this.setState({
			            subject: subject,
			            books: data,
			            book: false
			        })
	        	);
	    }
	    selectBook(book) {
	    	/* above receives title; should use id but label of button determines value due to button component */

		    fetch('books?title_like=' + book)
			    .then((results) => results.json())
		    	.then((book) =>
			        this.setState({
			        	book: book
			        })
	        	);
	    }
	    updateBookInfo(book) {
	    	/* SEND UPDATE TO API, NOT IN USE YET */

		    fetch('books?title_like=' + book)
			    .then((results) => results.json())
		    	.then((book) =>
			        this.setState({
			        	book: book
			        })
	        	);
	    }
	    render() {
	        return <Chooser selectSubject={this.selectSubject} subjects={this.state.subjects} subject={this.state.subject} selectBook={this.selectBook} books={this.state.books} book={this.state.book} updateBookInfo={this.props.updateBookInfo} />;
	    }
	}

    class Chooser extends React.Component {	
	    render() {
	        return (
	        	<div>
					{<SubjectChooser subjects={this.props.subjects} selectSubject={this.props.selectSubject} subject={this.props.subject}/>}
	        		{this.props.subject ? <BookChooser selectBook={this.props.selectBook} books={this.props.books} /> : null}
	        		{this.props.book ? <BookInfoEditer updateBookInfo={this.props.updateBookInfo} book={this.props.book} /> : null}
	        	</div>
	        );
	    }
	}

    class SubjectChooser extends React.Component {	
	    render() {
	    	let selectSubject = this.props.selectSubject;
	    	let buttonsArray = this.props.subjects.map(function(subject, index){
				return <Button label={subject} key={index} updateFn={selectSubject} />;
			});

	        return (
	        	<div>
					<h2>Subjects</h2>
					{buttonsArray} 	
	        	</div>
	        );
	    }
	}

    class BookChooser extends React.Component {	
	    render() {
	    	let selectBook = this.props.selectBook;
	    	let buttons2Array = this.props.books.map(function(book, index){
				return <div key={index}><Button label={book.title} bookId={book.id} updateFn={selectBook} /></div>;
			});

	        return (
	        	<div> 
	        		<h2>Books</h2>
	        		{buttons2Array}
	        	</div>
	        )
	    }
	}

    class BookInfoEditer extends React.Component {
    	render() {
    		return (
    			<form>
    				<input defaultValue="title" />
    				<input defaultValue="author" />
    				<Button label="Update Info" updateFn={this.props.updateBookInfo} />
 		   		</form>
 		   	)
    	}
    }

    class Button extends React.Component {	
	    render() {
	        return <span onClick={() => this.props.updateFn(this.props.label)}>{this.props.label}</span>;
	    }
	}

   	ReactDOM.render(
   	    <App />,  
   	    document.getElementById("root")
   	);

    
    </script>
</body>
</html>